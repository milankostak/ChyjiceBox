"use strict";var ChyjiceBox;$(document).ready(function(){function e(e,t,n,i,o,a){this.href=e,this.title=t,this.type=n,this.loaded=!1,this.date=i,this.lat=o,this.longt=a}function t(){$("[data-chyjicebox]").each(function(){var t=$(this),i=t.attr("href"),o=i.toLowerCase().split(".")[i.toLowerCase().split(".").length-1];if(-1!==$.inArray(o,K)){var r=t.attr("data-chyjicebox"),c=t.children().attr("alt"),s=t.attr("data-date"),l=t.attr("data-lat"),u=t.attr("data-long"),d=0;""!==r&&(d=A++);var h="webm"===o?ne.VIDEO:ne.IMAGE,f=new e(i,c,h,s,l,u);""!==r&&"pdf"!==o&&H.push(f),t.click(function(e){return 1===e.button||(""===r&&(Y=void 0!==t.attr("data-fittoscreen")),X="pdf"===o,X?(pe.attr("src",i),fe.attr("href",i),fe.show(),a()):(fe.hide(),G=""!==r,G?ce.addClass("cursorpointer"):ce.removeClass("cursorpointer"),S=!0,L=!1,B=f,A=d,w(),n()),!1)})}})}function n(){if(B.type===ne.IMAGE){B.loaded||re.show();var e=new Image;e.onload=function(){if(B.loaded=!0,!L){o(this);for(var e=1;G&&e<=Z;e++)l(e)}},e.onerror=function(){B.loaded=!0,L||o(!1)},R=!0,e.src=B.href}else o()}function o(e){re.hide();var t,n;if(B.type===ne.IMAGE?(se.removeClass("top"),P="object"==typeof e,t=q=P?e.width:C,n=V=P?e.height:T):(se.addClass("top"),P=!0,t=q=1920,n=V=1080),S&&a(),P){var i=r();c(i[0],i[1],D.scrollTop()+i[2])}else se.css("display","none"),c(t,n,f());_||(le.css("display",A>0&&G?"block":"none"),ue.css("display",A<H.length-1&&G?"block":"none")),ae.css("height",D.height())}function a(){if(y(),ie.show(),Y||X){var e=O.innerWidth();O.css("overflow","hidden"),e=O.innerWidth()-e,M.css("padding-right",e+"px")}ae.fadeIn(200,function(){(X?pe:oe).fadeIn(100,function(){ae.css("height",D.height())})})}function r(){var e=$(window).width(),t=$(window).height(),n=q,i=V,o=!1,a=!1;Y&&i>t&&(i=t,n=q*i/V,o=!0),Y&&n>e&&(n=e,i=V*n/q,a=!0);var r=0;return Y&&(a||!a&&!o)&&(r=(t-i)/2),[n,i,r]}function c(e,t,n){var i=$(window).width(),o=S?1:300,a=S?1:180;e=Math.round(e),t=Math.round(t),n=Math.round(n);var r=Math.round((i-e)/2);r<0&&(r=0);var c=Math.round(e-4);oe.css("width")===e+"px"&&oe.css("height")===t+"px"&&oe.css("top")===n+"px"&&oe.css("left")===r+"px"&&(o=0,a=0),ce.fadeOut(a,function(){void 0!==B.title?(se.html(s()),se.animate({width:c},o),"none"===se.css("display")&&P&&se.fadeIn(o)):(se.html(""),se.css("display","none")),oe.animate({width:e,height:t,top:n,left:r},o,function(){var n;n=B.type===ne.IMAGE?P?'<img src="'+B.href+'" width="'+e+'px" height="'+t+'px">':z:'<video width="'+e+'px" src="'+B.href+'" controls></video>',ce.html(n),R=!1,ce.fadeIn(a)})})}function s(){var e="&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;",t=G?A+1+"/"+H.length:"";if(void 0!==B.date&&(t+=e+B.date),""!==B.lat&&void 0!==B.lat){t+=e+('<a href="https://maps.google.com?q='+B.lat+","+B.longt+'">Mapa</a>')}return t+=e+B.title}function l(e){var t=W?e:-e,n=A+t;A+t<0?n=0:A+t>H.length-1&&(n=H.length-1);var i=H[n];if(!i.loaded&&i.type!==ne.VIDEO){var o=new Image;o.onload=function(){i.loaded=!0},o.src=i.href}}function u(){!R&&A>0&&G&&(B=H[--A],W=S=!1,n())}function d(){!R&&A<H.length-1&&G&&(B=H[++A],W=!0,S=!1,n())}function h(){H.length=0,A=0,L=!0,re.hide()}function f(){var e=$(window).height(),t=2*e/5;return D.scrollTop()+t}function p(){Q=!0;var e=$(window).width(),t=r(),n=t[0],i=t[1],o=t[2];oe.animate({width:P?n:C,height:P?i:T,top:P?D.scrollTop()+o:f(),left:(e-n)/2},200),se.animate({width:n-4},200),ce.children().animate({width:n,height:i},200),ae.css("height",D.height())}function m(e){if(G){v(e.originalEvent.wheelDelta||-e.detail)<0?d():u(),e.preventDefault()}}function v(e){return e>0?1:e<0?-1:0}function g(){D.unbind(J)}function w(){D.bind(J,function(e){var t=e.ctrlKey||e.shiftKey||e.altKey;switch(e.which){case 32:if(B.type===ne.VIDEO){var n=I();n.paused?n.play():n.pause(),e.preventDefault()}return!1;case 27:me(),e.preventDefault();break;case 87:case 65:case 33:case 38:case 37:if(!t)return u(),e.preventDefault(),b(),!1;e.shiftKey^e.ctrlKey&&37===e.which&&B.type===ne.VIDEO&&(E(e.shiftKey?-3:-30),e.preventDefault());break;case 83:case 68:case 34:case 40:case 39:if(!t)return d(),e.preventDefault(),b(),!1;e.shiftKey^e.ctrlKey&&39===e.which&&B.type===ne.VIDEO&&(E(e.shiftKey?3:30),e.preventDefault());break;case 70:F();break;case 8:case 13:e.preventDefault()}})}function b(){_||(_=!0,x(),le.animate({left:"-150"},350,function(){le.hide().css("left",0)}),ue.animate({right:"-150"},350,function(){ue.hide().css("right",0)}),de.animate({top:"-50"},350,function(){de.hide().css("top",0)}),he.animate({top:"-50"},350,function(){he.hide().css("top",0)}))}function y(){_&&(_=!1,A>0&&G&&le.css("left",-150).show().animate({left:"0"},350),A<H.length-1&&G&&ue.css("right",-150).show().animate({right:"0"},350),de.css("top",-50).show().animate({top:"0"},350),he.css("top",-50).show().animate({top:"0"},350))}function x(){ie.bind(N,function(e){y(),k()})}function k(){ie.unbind(N)}function E(e){var t=I(),n=t.currentTime+e;n<0?t.currentTime=0:n>t.duration?t.currentTime=t.duration:t.currentTime=n}function I(){return $("#chyjicebox > #imgbox video")[0]}function F(){document.fullscreenElement===ve||document.webkitFullscreenElement===ve||document.mozFullscreenElement===ve||document.mozFullScreenElement===ve||document.msFullscreenElement===ve?(document.exitFullscreen(),he.removeClass("shrink")):(ve.requestFullscreen(),he.addClass("shrink"))}var D=$(document),M=$("body"),O=$("html"),j="chyjicebox",z='<div class="'+j+'-notfound">Obrázek nebyl nalezen.</strong></div>',C=200,T=50,K=["gif","jpg","jpeg","png","pdf","webm"],q=0,V=0,A=0,G=!1,S=!0,R=!1,P=!0,L=!0,W=!0,X=!1,Y=!0,_=!1,Z=2,B=null,H=[],J="keydown.chyjicebox-keypress",N="mousemove.chyjicebox-mousemove",Q=!0,U=null,ee=null,te=null,ne={};ne.IMAGE=1,ne.VIDEO=2,M.append('<div id="'+j+'-wrapper"></div>');var ie=$("#"+j+"-wrapper");ie.append('<div id="'+j+'"></div>');var oe=$("#"+j);ie.append('<div id="'+j+'-overlay"></div>');var ae=$("#"+j+"-overlay");M.append('<div id="'+j+'-loading"></div>');var re=$("#"+j+"-loading");oe.append('<div id="imgbox"></div>');var ce=$("#"+j+" #imgbox");oe.append('<div id="title"></div>');var se=$("#"+j+" #title");ie.append('<button id="'+j+'-prev" type="button" title="Předchozí">◁</button>');var le=$("#"+j+"-prev");ie.append('<button id="'+j+'-next" type="button" title="Další">▷</button>');var ue=$("#"+j+"-next");ie.append('<button id="'+j+'-close" title="Zavřít">✕</button>');var de=$("#"+j+"-close");ie.append('<button id="'+j+'-full" title="Celá obrazovka"></button>');var he=$("#"+j+"-full");ie.append('<a id="newtab" href="" onclick="window.open(this.href); return false;">Otevřít ve vlastním okně</a>');var fe=$("#newtab");ie.append('<iframe id="'+j+'-iframe" src=""></iframe>');var pe=$("#"+j+"-iframe"),me=function(){document.exitFullscreen(),he.removeClass("shrink"),g(),re.hide(),pe.hide(),oe.fadeOut(70),ie.fadeOut(250,function(){L=!0,(Y||X)&&(O.css("overflow","auto"),M.css("padding-right","0")),ae.hide(),ce.html(""),se.html(""),""!==pe.attr("src")&&pe.attr("src",""),y()})};re.click(me),de.click(me),ae.click(me),le.click(u),ue.click(d),ce.click(function(){var e=I();(B.type!==ne.VIDEO||0===e.currentTime||e.paused)&&d()}),ie.on("touchstart",function(e){ee=e.touches[0].clientX,te=e.touches[0].clientY}),ie.on("touchmove",function(e){if(ee&&te){var t=e.touches[0].clientX,n=e.touches[0].clientY,i=ee-t,o=te-n;Math.abs(i)>Math.abs(o)&&(i>0?d():u(),b()),ee=null,te=null}}),$(window).resize(function(){Q&&(Q=!1,clearTimeout(U),U=setTimeout(p,500))}),oe.bind("mousewheel DOMMouseScroll",m);var ve=document.body;ve.requestFullscreen=ve.requestFullscreen||ve.mozRequestFullscreen||ve.mozRequestFullScreen||ve.webkitRequestFullscreen||ve.msRequestFullscreen,document.exitFullscreen=document.exitFullscreen||document.mozExitFullscreen||document.mozExitFullScreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,he.click(F),function(){(new Image).src="/img/chyjicebox/loading.gif",(new Image).src="/img/chyjicebox/full.png",(new Image).src="/img/chyjicebox/shrink.png"}(),ChyjiceBox={},ChyjiceBox.init=function(e){e&&(Y=!1),t()},ChyjiceBox.clean=function(){h()},ChyjiceBox.isClosed=function(){return L}});