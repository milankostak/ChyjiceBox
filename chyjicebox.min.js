"use strict";var ChyjiceBox;$(document).ready(function(){var u=$(document),t=$("body"),n=$("html"),e="chyjicebox",s='<div class="'+e+'-notfound">Obrázek nebyl nalezen.</strong></div>',o=200,c=50,h=["gif","jpg","jpeg","png","pdf","webm","mp4"],r=0,l=0,f=0,p=!1,m=!0,d=!1,v=!0,g=!0,w=!0,b=!1,y=!0,a=!1,i=2,x=20,k=null,E=[],I="keydown.chyjicebox-keypress",F="mousemove.chyjicebox-mousemove",D=!0,j=null,C=null,M=null,O={};function z(e,t,n,i,a,o){this.href=e,this.title=t,this.type=n,this.loaded=!1,this.date=i,this.lat=a,this.longt=o}O.IMAGE=1,O.VIDEO=2,t.append('<div id="'+e+'-wrapper"></div>');var T=$("#"+e+"-wrapper");T.append('<div id="'+e+'"></div>');var K=$("#"+e);T.append('<div id="'+e+'-overlay"></div>');var q=$("#"+e+"-overlay");t.append('<div id="'+e+'-loading"></div>');var V=$("#"+e+"-loading");K.append('<div id="imgbox"></div>');var A=$("#"+e+" #imgbox");K.append('<div id="title"></div>');var G=$("#"+e+" #title");T.append('<button id="'+e+'-prev" type="button" title="Předchozí">◁</button>');var S=$("#"+e+"-prev");T.append('<button id="'+e+'-next" type="button" title="Další">▷</button>');var R=$("#"+e+"-next");T.append('<button id="'+e+'-close" title="Zavřít">✕</button>');var B=$("#"+e+"-close");T.append('<button id="'+e+'-full" title="Celá obrazovka"></button>');var L=$("#"+e+"-full");T.append('<a id="newtab" href="" onclick="window.open(this.href); return false;">Otevřít ve vlastním okně</a>');var W=$("#newtab");T.append('<iframe id="'+e+'-iframe" src=""></iframe>');var X=$("#"+e+"-iframe");function Y(){$("[data-chyjicebox]").each(function(){var t=$(this),n=t.attr("href"),i=n.toLowerCase().split(".")[n.toLowerCase().split(".").length-1];if(-1!==$.inArray(i,h)){var a=t.attr("data-chyjicebox"),e=t.children().attr("alt"),o=t.attr("data-date"),c=t.attr("data-lat"),r=t.attr("data-long"),s=0;""!==a&&(s=f++);var l="webm"===i||"mp4"===i?O.VIDEO:O.IMAGE,d=new z(n,e,l,o,c,r);""!==a&&"pdf"!==i&&E.push(d),t.click(function(e){return 1===e.button||(""===a&&(y=void 0!==t.attr("data-fittoscreen")),(b="pdf"===i)?(X.attr("src",n),W.attr("href",n),W.show(),H()):(W.hide(),(p=""!==a)?A.addClass("cursorpointer"):A.removeClass("cursorpointer"),g=!(m=!0),k=d,f=s,u.bind(I,function(e){var t=e.ctrlKey||e.shiftKey||e.altKey;switch(e.which){case 32:if(k.type===O.VIDEO){var n=ce();n.paused?n.play():n.pause(),e.preventDefault()}return!1;case 27:J(),e.preventDefault();break;case 87:case 65:case 33:case 38:case 37:if(!t)return _(),e.preventDefault(),ie(),!1;e.shiftKey^e.ctrlKey&&37===e.which&&k.type===O.VIDEO&&(oe(e.shiftKey?-3:-30),e.preventDefault());break;case 83:case 68:case 34:case 40:case 39:if(!t)return ee(),e.preventDefault(),ie(),!1;e.shiftKey^e.ctrlKey&&39===e.which&&k.type===O.VIDEO&&(oe(e.shiftKey?3:30),e.preventDefault());break;case 70:se();break;case 8:case 13:e.preventDefault()}}),P()),!1)})}})}function P(){if(k.type===O.IMAGE){k.loaded||V.show();var e=new Image;e.onload=function(){if(k.loaded=!0,!g){Z(this);for(var e=1;p&&e<=i;e++)U(e)}},e.onerror=function(){k.loaded=!0,g||Z(!1)},d=!0,e.src=k.href}else Z()}function Z(e){var t,n;if(V.hide(),k.type===O.IMAGE?(G.removeClass("top"),t=r=(v="object"==typeof e)?e.width:o,n=l=v?e.height:c):(G.addClass("top"),v=!0,t=r=1920,n=l=1080),m&&H(),v){var i=N();Q(i[0],i[1],u.scrollTop()+i[2])}else G.css("display","none"),Q(t,n,te());a||(S.css("display",0<f&&p?"block":"none"),R.css("display",f<E.length-1&&p?"block":"none")),q.css("height",u.height())}function H(){if(ae(),T.show(),y||b){var e=n.innerWidth();n.css("overflow","hidden"),e=n.innerWidth()-e,t.css("padding-right",e+"px")}q.fadeIn(200,function(){(b?X:K).fadeIn(100,function(){q.css("height",u.height())})})}var J=function(){document.exitFullscreen(),L.removeClass("shrink"),u.unbind(I),V.hide(),X.hide(),K.fadeOut(70),T.fadeOut(250,function(){g=!0,(y||b)&&(n.css("overflow","auto"),t.css("padding-right","0")),q.hide(),A.html(""),G.html(""),""!==X.attr("src")&&X.attr("src",""),ae()})};function N(){var e=$(window).width(),t=$(window).height(),n=r,i=l,a=!1,o=!1;y&&t<i&&(n=r*(i=t)/l,a=!0),y&&e<n&&(i=l*(n=e)/r,o=!0);var c=0;return y&&(o||!o&&!a)&&(c=(t-i)/2),[n,i,c]}function Q(t,n,e){var i=$(window).width(),a=m?1:300,o=m?1:180;t=Math.round(t),n=Math.round(n),e=Math.round(e);var c=Math.round((i-t)/2);c<0&&(c=0);var r=t-x;K.css("width")===t+"px"&&K.css("height")===n+"px"&&K.css("top")===e+"px"&&K.css("left")===c+"px"&&(o=a=0),A.fadeOut(o,function(){void 0!==k.title?(G.html(function(){var e="&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;",t=p?f+1+"/"+E.length:"";void 0!==k.date&&(t+=e+k.date);if(""!==k.lat&&void 0!==k.lat){var n='<a href="https://maps.google.com?q='+k.lat+","+k.longt+'">Mapa</a>';t+=e+n}return t+=e+k.title}()),G.animate({width:r},a),"none"===G.css("display")&&v&&G.fadeIn(a)):(G.html(""),G.css("display","none")),K.animate({width:t,height:n,top:e,left:c},a,function(){var e;e=k.type===O.IMAGE?v?'<img src="'+k.href+'" width="'+t+'px" height="'+n+'px">':s:'<video width="'+t+'px" src="'+k.href+'" controls></video>',A.html(e),d=!1,A.fadeIn(o)})})}function U(e){var t=w?e:-e,n=f+t;f+t<0?n=0:f+t>E.length-1&&(n=E.length-1);var i=E[n];if(!i.loaded&&i.type!==O.VIDEO){var a=new Image;a.onload=function(){i.loaded=!0},a.src=i.href}}function _(){!d&&0<f&&p&&(k=E[--f],w=m=!1,P())}function ee(){!d&&f<E.length-1&&p&&(k=E[++f],m=!(w=!0),P())}function te(){var e=2*$(window).height()/5;return u.scrollTop()+e}function ne(){D=!0;var e=$(window).width(),t=N(),n=t[0],i=t[1],a=t[2];K.animate({width:v?n:o,height:v?i:c,top:v?u.scrollTop()+a:te(),left:(e-n)/2},200),G.animate({width:n-x},200),A.children().animate({width:n,height:i},200),q.css("height",u.height())}function ie(){a||(a=!0,T.bind(F,function(e){ae(),T.unbind(F)}),S.animate({left:"-150"},350,function(){S.hide().css("left",0)}),R.animate({right:"-150"},350,function(){R.hide().css("right",0)}),B.animate({top:"-50"},350,function(){B.hide().css("top",0)}),L.animate({top:"-50"},350,function(){L.hide().css("top",0)}))}function ae(){a&&(a=!1,0<f&&p&&S.css("left",-150).show().animate({left:"0"},350),f<E.length-1&&p&&R.css("right",-150).show().animate({right:"0"},350),B.css("top",-50).show().animate({top:"0"},350),L.css("top",-50).show().animate({top:"0"},350))}function oe(e){var t=ce(),n=t.currentTime+e;n<0?t.currentTime=0:n>t.duration?t.currentTime=t.duration:t.currentTime=n}function ce(){return $("#chyjicebox > #imgbox video")[0]}V.click(J),B.click(J),q.click(J),S.click(_),R.click(ee),A.click(function(){var e=ce();(k.type!==O.VIDEO||0===e.currentTime||e.paused)&&ee()}),T.on("touchstart",function(e){C=e.touches[0].clientX,M=e.touches[0].clientY}),T.on("touchmove",function(e){if(C&&M){var t=e.touches[0].clientX,n=e.touches[0].clientY,i=C-t,a=M-n;Math.abs(i)>Math.abs(a)&&(0<i?ee():_(),ie()),M=C=null}}),$(window).resize(function(){D&&(D=!1,clearTimeout(j),j=setTimeout(ne,500))}),K.bind("mousewheel DOMMouseScroll",function(e){var t;p&&((0<(t=e.originalEvent.wheelDelta||-e.detail)?1:t<0?-1:0)<0?ee():_(),e.preventDefault())});var re=document.body;function se(){document.fullscreenElement===re||document.webkitFullscreenElement===re||document.mozFullscreenElement===re||document.mozFullScreenElement===re||document.msFullscreenElement===re?(document.exitFullscreen(),L.removeClass("shrink")):(re.requestFullscreen(),L.addClass("shrink"))}re.requestFullscreen=re.requestFullscreen||re.mozRequestFullscreen||re.mozRequestFullScreen||re.webkitRequestFullscreen||re.msRequestFullscreen,document.exitFullscreen=document.exitFullscreen||document.mozExitFullscreen||document.mozExitFullScreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,L.click(se),(new Image).src="/img/chyjicebox/loading.gif",(new Image).src="/img/chyjicebox/full.png",(new Image).src="/img/chyjicebox/shrink.png",(ChyjiceBox={init:function(e){e&&(y=!1),Y()}}).clean=function(){E.length=0,g=!(f=0),V.hide()},ChyjiceBox.isClosed=function(){return g}});