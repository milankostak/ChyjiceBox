"use strict";var ChyjiceBox;$(document).ready(function(){function e(e,t,n,i,o,a){this.href=e,this.title=t,this.type=n,this.loaded=!1,this.date=i,this.lat=o,this.longt=a}function t(){$("[data-chyjicebox]").each(function(){var t=$(this),i=t.attr("href"),o=i.toLowerCase().split(".")[i.toLowerCase().split(".").length-1];if(-1!==$.inArray(o,K)){var r=t.attr("data-chyjicebox"),c=t.children().attr("alt"),s=t.attr("data-date"),l=t.attr("data-lat"),u=t.attr("data-long"),d=0;""!==r&&(d=A++);var h="webm"===o?ie.VIDEO:ie.IMAGE,f=new e(i,c,h,s,l,u);""!==r&&"pdf"!==o&&J.push(f),t.click(function(e){return 1===e.button||(""===r&&(Y=void 0!==t.attr("data-fittoscreen")),X="pdf"===o,X?(me.attr("src",i),pe.attr("href",i),pe.show(),a()):(pe.hide(),G=""!==r,G?se.addClass("cursorpointer"):se.removeClass("cursorpointer"),S=!0,L=!1,H=f,A=d,w(),n()),!1)})}})}function n(){if(H.type===ie.IMAGE){H.loaded||ce.show();var e=new Image;e.onload=function(){if(H.loaded=!0,!L){o(this);for(var e=1;G&&e<=Z;e++)l(e)}},e.onerror=function(){H.loaded=!0,L||o(!1)},R=!0,e.src=H.href}else o()}function o(e){ce.hide();var t,n;if(H.type===ie.IMAGE?(le.removeClass("top"),P="object"==typeof e,t=q=P?e.width:C,n=V=P?e.height:T):(le.addClass("top"),P=!0,t=q=1920,n=V=1080),S&&a(),P){var i=r();c(i[0],i[1],D.scrollTop()+i[2])}else le.css("display","none"),c(t,n,f());_||(ue.css("display",A>0&&G?"block":"none"),de.css("display",A<J.length-1&&G?"block":"none")),re.css("height",D.height())}function a(){if(y(),oe.show(),Y||X){var e=M.innerWidth();M.css("overflow","hidden"),e=M.innerWidth()-e,O.css("padding-right",e+"px")}re.fadeIn(200,function(){(X?me:ae).fadeIn(100,function(){re.css("height",D.height())})})}function r(){var e=$(window).width(),t=$(window).height(),n=q,i=V,o=!1,a=!1;Y&&i>t&&(i=t,n=q*i/V,o=!0),Y&&n>e&&(n=e,i=V*n/q,a=!0);var r=0;return Y&&(a||!a&&!o)&&(r=(t-i)/2),[n,i,r]}function c(e,t,n){var i=$(window).width(),o=S?1:300,a=S?1:180;e=Math.round(e),t=Math.round(t),n=Math.round(n);var r=Math.round((i-e)/2);r<0&&(r=0);var c=e-B;ae.css("width")===e+"px"&&ae.css("height")===t+"px"&&ae.css("top")===n+"px"&&ae.css("left")===r+"px"&&(o=0,a=0),se.fadeOut(a,function(){void 0!==H.title?(le.html(s()),le.animate({width:c},o),"none"===le.css("display")&&P&&le.fadeIn(o)):(le.html(""),le.css("display","none")),ae.animate({width:e,height:t,top:n,left:r},o,function(){var n;n=H.type===ie.IMAGE?P?'<img src="'+H.href+'" width="'+e+'px" height="'+t+'px">':z:'<video width="'+e+'px" src="'+H.href+'" controls></video>',se.html(n),R=!1,se.fadeIn(a)})})}function s(){var e="&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;",t=G?A+1+"/"+J.length:"";if(void 0!==H.date&&(t+=e+H.date),""!==H.lat&&void 0!==H.lat){t+=e+('<a href="https://maps.google.com?q='+H.lat+","+H.longt+'">Mapa</a>')}return t+=e+H.title}function l(e){var t=W?e:-e,n=A+t;A+t<0?n=0:A+t>J.length-1&&(n=J.length-1);var i=J[n];if(!i.loaded&&i.type!==ie.VIDEO){var o=new Image;o.onload=function(){i.loaded=!0},o.src=i.href}}function u(){!R&&A>0&&G&&(H=J[--A],W=S=!1,n())}function d(){!R&&A<J.length-1&&G&&(H=J[++A],W=!0,S=!1,n())}function h(){J.length=0,A=0,L=!0,ce.hide()}function f(){var e=$(window).height(),t=2*e/5;return D.scrollTop()+t}function p(){U=!0;var e=$(window).width(),t=r(),n=t[0],i=t[1],o=t[2];ae.animate({width:P?n:C,height:P?i:T,top:P?D.scrollTop()+o:f(),left:(e-n)/2},200),le.animate({width:n-B},200),se.children().animate({width:n,height:i},200),re.css("height",D.height())}function m(e){if(G){v(e.originalEvent.wheelDelta||-e.detail)<0?d():u(),e.preventDefault()}}function v(e){return e>0?1:e<0?-1:0}function g(){D.unbind(N)}function w(){D.bind(N,function(e){var t=e.ctrlKey||e.shiftKey||e.altKey;switch(e.which){case 32:if(H.type===ie.VIDEO){var n=I();n.paused?n.play():n.pause(),e.preventDefault()}return!1;case 27:ve(),e.preventDefault();break;case 87:case 65:case 33:case 38:case 37:if(!t)return u(),e.preventDefault(),b(),!1;e.shiftKey^e.ctrlKey&&37===e.which&&H.type===ie.VIDEO&&(E(e.shiftKey?-3:-30),e.preventDefault());break;case 83:case 68:case 34:case 40:case 39:if(!t)return d(),e.preventDefault(),b(),!1;e.shiftKey^e.ctrlKey&&39===e.which&&H.type===ie.VIDEO&&(E(e.shiftKey?3:30),e.preventDefault());break;case 70:F();break;case 8:case 13:e.preventDefault()}})}function b(){_||(_=!0,x(),ue.animate({left:"-150"},350,function(){ue.hide().css("left",0)}),de.animate({right:"-150"},350,function(){de.hide().css("right",0)}),he.animate({top:"-50"},350,function(){he.hide().css("top",0)}),fe.animate({top:"-50"},350,function(){fe.hide().css("top",0)}))}function y(){_&&(_=!1,A>0&&G&&ue.css("left",-150).show().animate({left:"0"},350),A<J.length-1&&G&&de.css("right",-150).show().animate({right:"0"},350),he.css("top",-50).show().animate({top:"0"},350),fe.css("top",-50).show().animate({top:"0"},350))}function x(){oe.bind(Q,function(e){y(),k()})}function k(){oe.unbind(Q)}function E(e){var t=I(),n=t.currentTime+e;n<0?t.currentTime=0:n>t.duration?t.currentTime=t.duration:t.currentTime=n}function I(){return $("#chyjicebox > #imgbox video")[0]}function F(){document.fullscreenElement===ge||document.webkitFullscreenElement===ge||document.mozFullscreenElement===ge||document.mozFullScreenElement===ge||document.msFullscreenElement===ge?(document.exitFullscreen(),fe.removeClass("shrink")):(ge.requestFullscreen(),fe.addClass("shrink"))}var D=$(document),O=$("body"),M=$("html"),j="chyjicebox",z='<div class="'+j+'-notfound">Obrázek nebyl nalezen.</strong></div>',C=200,T=50,K=["gif","jpg","jpeg","png","pdf","webm"],q=0,V=0,A=0,G=!1,S=!0,R=!1,P=!0,L=!0,W=!0,X=!1,Y=!0,_=!1,Z=2,B=20,H=null,J=[],N="keydown.chyjicebox-keypress",Q="mousemove.chyjicebox-mousemove",U=!0,ee=null,te=null,ne=null,ie={};ie.IMAGE=1,ie.VIDEO=2,O.append('<div id="'+j+'-wrapper"></div>');var oe=$("#"+j+"-wrapper");oe.append('<div id="'+j+'"></div>');var ae=$("#"+j);oe.append('<div id="'+j+'-overlay"></div>');var re=$("#"+j+"-overlay");O.append('<div id="'+j+'-loading"></div>');var ce=$("#"+j+"-loading");ae.append('<div id="imgbox"></div>');var se=$("#"+j+" #imgbox");ae.append('<div id="title"></div>');var le=$("#"+j+" #title");oe.append('<button id="'+j+'-prev" type="button" title="Předchozí">◁</button>');var ue=$("#"+j+"-prev");oe.append('<button id="'+j+'-next" type="button" title="Další">▷</button>');var de=$("#"+j+"-next");oe.append('<button id="'+j+'-close" title="Zavřít">✕</button>');var he=$("#"+j+"-close");oe.append('<button id="'+j+'-full" title="Celá obrazovka"></button>');var fe=$("#"+j+"-full");oe.append('<a id="newtab" href="" onclick="window.open(this.href); return false;">Otevřít ve vlastním okně</a>');var pe=$("#newtab");oe.append('<iframe id="'+j+'-iframe" src=""></iframe>');var me=$("#"+j+"-iframe"),ve=function(){document.exitFullscreen(),fe.removeClass("shrink"),g(),ce.hide(),me.hide(),ae.fadeOut(70),oe.fadeOut(250,function(){L=!0,(Y||X)&&(M.css("overflow","auto"),O.css("padding-right","0")),re.hide(),se.html(""),le.html(""),""!==me.attr("src")&&me.attr("src",""),y()})};ce.click(ve),he.click(ve),re.click(ve),ue.click(u),de.click(d),se.click(function(){var e=I();(H.type!==ie.VIDEO||0===e.currentTime||e.paused)&&d()}),oe.on("touchstart",function(e){te=e.touches[0].clientX,ne=e.touches[0].clientY}),oe.on("touchmove",function(e){if(te&&ne){var t=e.touches[0].clientX,n=e.touches[0].clientY,i=te-t,o=ne-n;Math.abs(i)>Math.abs(o)&&(i>0?d():u(),b()),te=null,ne=null}}),$(window).resize(function(){U&&(U=!1,clearTimeout(ee),ee=setTimeout(p,500))}),ae.bind("mousewheel DOMMouseScroll",m);var ge=document.body;ge.requestFullscreen=ge.requestFullscreen||ge.mozRequestFullscreen||ge.mozRequestFullScreen||ge.webkitRequestFullscreen||ge.msRequestFullscreen,document.exitFullscreen=document.exitFullscreen||document.mozExitFullscreen||document.mozExitFullScreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,fe.click(F),function(){(new Image).src="/img/chyjicebox/loading.gif",(new Image).src="/img/chyjicebox/full.png",(new Image).src="/img/chyjicebox/shrink.png"}(),ChyjiceBox={},ChyjiceBox.init=function(e){e&&(Y=!1),t()},ChyjiceBox.clean=function(){h()},ChyjiceBox.isClosed=function(){return L}});